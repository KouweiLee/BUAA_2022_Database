# 系统设计报告

## 三、数据库逻辑模式设计

### 1.数据库关系模式

根据系统全局ER图，我们设计了15个关系模式，每个关系模式都是一个五元组：
$$
R(U,D,DOM,F)
$$
这里：

* 关系名$R$是符号化的元组语义
* $U$是组成该关系的属性集合
* $D$为属性组$U$中的属性所来自的域
* $DOM$为属性到域的映射
* $F$为属性组$U$的一组函数依赖

在下面的设计分析中，为了简洁起见，只讨论三元组$R(U, F)$。

#### 1. tb_user

* 关系名$R$：$tb\_user$
* 属性集合$U$:

|     属性名      |   中文含义   |
| :-------------: | :----------: |
| <u>username</u> |   用户账号   |
|    password     |   用户密码   |
|      name       |   用户姓名   |
|   numOfTitles   |  用户发帖数  |
|      photo      |   用户照片   |
|     profile     |   用户简介   |
|   isSuperUser   | 是否为管理员 |

* 函数依赖集合$F$:
  * $username\rightarrow password$
  * $username\rightarrow name$
  * $username\rightarrow numOfTitles$
  * $username\rightarrow photo$
  * $username\rightarrow profile$
  * $username\rightarrow isSuperUser$


#### 2. tb_pics

* 关系名$R$：$tb\_pics$
* 属性集合$U$：

|  属性名   |   中文含义   |
| :-------: | :----------: |
| <u>id</u> |    图片id    |
| position  |   图片位置   |
| username  | 图片所属用户 |

* 函数依赖集合$F$：
  * $id\rightarrow position$
  * $id\rightarrow username$


#### 3. dc_title

* 关系名$R$：$dc\_title$
* 属性集合$U$：

|  属性名   |  中文含义  |
| :-------: | :--------: |
| <u>id</u> |  主题帖id  |
|   title   |    标题    |
|  content  |    内容    |
|   time    |  发帖时间  |
| username  |  发帖用户  |
| numofcoms | 贴内评论数 |

* 函数依赖集合$F$：
  * $id\rightarrow title$
  * $id\rightarrow content$
  * $id\rightarrow time$
  * $id\rightarrow username$
  * $id\rightarrow numofcoms$

#### 4. dc_comment

* 关系名$R$：$dc\_comment$
* 属性集合$U$：

|      属性名      |   中文含义   |
| :--------------: | :----------: |
|    <u>id</u>     |   评论贴id   |
|     content      |     内容     |
|       time       |   发帖时间   |
|     username     |   发帖用户   |
| commentatee_name | 被评论者名称 |

* 函数依赖集合$F$：
  * $id\rightarrow content$
  * $id\rightarrow time$
  * $id\rightarrow username$
  * $id\rightarrow commentatee\_name$

#### 5. dc_com2title

* 关系名$R$：$dc\_com2title$
* 属性集合$U$：

|   属性名   | 中文含义 |
| :--------: | :------: |
|  title_id  | 主题帖id |
| comment_id | 评论贴id |

* 函数依赖集合$F$：
  * $comment\_id\rightarrow title\_id$

#### 6. cl_class

* 关系名$R$：$cl\_class$
* 属性集合$U$：

|   属性名    |   中文含义   |
| :---------: | :----------: |
|  <u>id</u>  |    课程id    |
|    name     |   课程名称   |
| description |   课程描述   |
|   pingshi   | 课程平时占比 |
|    exam     | 课程考试占比 |
|    time     |   上课时间   |
|  position   |   上课地点   |

* 函数依赖集合$F$：
  * $id\rightarrow name$
  * $id\rightarrow description$
  * $id\rightarrow pingshi$
  * $id\rightarrow exam$
  * $id\rightarrow time$
  * $id\rightarrow position$

#### 7. cl_homework

* 关系名$R$：$cl\_homework$
* 属性集合$U$：

|    属性名    |   中文含义   |
| :----------: | :----------: |
|  <u>id</u>   |    作业id    |
|     name     |   作业名称   |
|   content    |   作业内容   |
|  begin_time  | 作业开始时间 |
|   end_time   | 作业截止时间 |
| averageScore |  作业平均分  |

* 函数依赖集合$F$：
  * $id\rightarrow name$
  * $id\rightarrow content$
  * $id\rightarrow begin\_time$
  * $id\rightarrow end\_time$
  * $id\rightarrow averageScore$

#### 8. cl_class_homework

* 关系名$R$：$cl\_class\_homework$
* 属性集合$U$：

|       属性名       | 中文含义 |
| :----------------: | :------: |
|      class_id      |  课程id  |
| <u>homework_id</u> |  作业id  |

* 函数依赖集合$F$：
  * $homework\_id\rightarrow class\_id$

#### 9. cl_class_user

* 关系名$R$：$cl\_class\_user$
* 属性集合$U$：

|  属性名  | 中文含义 |
| :------: | :------: |
| username | 用户账号 |
| class_id |  课程id  |

* 函数依赖集合$F$：码为全码，省略依赖关系 F 中的主属性对码的完全函数依赖。

#### 10. cl_homework_user

* 关系名$R$：$cl\_homework\_user$
* 属性集合$U$：

|   属性名    |   中文含义   |
| :---------: | :----------: |
|  <u>id</u>  |  作业文件id  |
|  username   |    提交者    |
| homework_id | 对应的作业id |
|    score    |   作业得分   |
|  last_time  | 最后提交时间 |
|  filename   |  作业文件名  |

* 函数依赖集合$F$：
  * $id\rightarrow username$
  * $id\rightarrow homework\_id$
  * $id\rightarrow score$
  * $id\rightarrow last\_time$
  * $id\rightarrow filename$

#### 11. cl_material

* 关系名$R$：$cl\_material$
* 属性集合$U$：

|  属性名   |   中文含义   |
| :-------: | :----------: |
| <u>id</u> |  课件附件id  |
|   name    |  附件文件名  |
|   time    | 附件上传时间 |

* 函数依赖集合$F$：
  * $id\rightarrow name$
  * $id\rightarrow time$

#### 12. cl_class_material

* 关系名$R$：$cl\_class\_material$
* 属性集合$U$：

|       属性名       |  中文含义  |
| :----------------: | :--------: |
|      class_id      |   课程id   |
| <u>material_id</u> | 课程附件id |

* 函数依赖集合$F$：
  * $material\_id\rightarrow class\_id$

#### 13. an_develops

* 关系名$R$：$an\_develops$
* 属性集合$U$：

|  属性名   |    中文含义    |
| :-------: | :------------: |
| <u>id</u> |   社团信息id   |
|   time    | 信息所属时间段 |
| overview  |  社团发展概况  |

* 函数依赖集合$F$：
  * $id\rightarrow time$
  * $id\rightarrow overview$

#### 14. an_develop_member

* 关系名$R$：$an\_develop\_member$
* 属性集合$U$：

|   属性名   |   中文含义   |
| :--------: | :----------: |
| develop_id |  社团信息id  |
|  username  | 成员用户账号 |

* 函数依赖集合$F$：码为全码，省略依赖关系 F 中的主属性对码的完全函数依赖。

#### 15. an_pics

* 关系名$R$：$an\_pics$
* 属性集合$U$：

|   属性名   |   中文含义   |
| :--------: | :----------: |
|  pic_url   | 图片存储位置 |
| develop_id |  社团信息id  |

* 函数依赖集合$F$：码为全码，省略依赖关系 F 中的主属性对码的完全函数依赖。

### 2. 关系模式范式等级的判定与规范化

#### 1. tb_user

在关系模式`tb_user`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`username`），因此符合2NF。
* 不存在非主属性对码（`username`）的传递函数依赖，因此符合3NF。

#### 2. tb_pics

在关系模式`tb_pics`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`id`），因此符合2NF。
* 不存在非主属性对码（`id`）的传递函数依赖，因此符合3NF。

#### 3. dc_title

在关系模式`dc_title`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`id`），因此符合2NF。
* 不存在非主属性对码（`id`）的传递函数依赖，因此符合3NF。

#### 4. dc_comment

在关系模式`dc_comment`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`id`），因此符合2NF。
* 不存在非主属性对码（`id`）的传递函数依赖，因此符合3NF。

#### 5. dc_com2title

在关系模式`dc_com2title`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`comment_id`），因此符合2NF。
* 不存在非主属性对码（`comment_id`）的传递函数依赖，因此符合3NF。

#### 6. cl_class

在关系模式`cl_class`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`id`），因此符合2NF。
* 不存在非主属性对码（`id`）的传递函数依赖，因此符合3NF。

#### 7. cl_homework

在关系模式`cl_homework`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`id`），因此符合2NF。
* 不存在非主属性对码（`id`）的传递函数依赖，因此符合3NF。

#### 8. cl_class_homework

在关系模式`cl_class_homework`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`homework_id`），因此符合2NF。
* 不存在非主属性对码（`homework_id`）的传递函数依赖，因此符合3NF。

#### 9. cl_class_user

在关系模式`cl_class_user`中，由于是全码，因此没有非主属性，因此一定不存在非主属性对码的部分和传递函数依赖，因此符合3NF。

#### 10. cl_homework_user

在关系模式`cl_homework_user`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`id`），因此符合2NF。
* 不存在非主属性对码（`id`）的传递函数依赖，因此符合3NF。

#### 11. cl_material

在关系模式`cl_material`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`id`），因此符合2NF。
* 不存在非主属性对码（`id`）的传递函数依赖，因此符合3NF。

#### 12. cl_class_material

在关系模式`cl_class_material`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`material_id`），因此符合2NF。
* 不存在非主属性对码（`material_id`）的传递函数依赖，因此符合3NF。

#### 13. an_develops

在关系模式`an_develops`中，满足：

* 每一个非主属性都完全函数依赖于所有候选码（`id`），因此符合2NF。
* 不存在非主属性对码（`id`）的传递函数依赖，因此符合3NF。

#### 14. an_develop_member

在关系模式`an_develop_member`中，由于是全码，因此没有非主属性，因此一定不存在非主属性对码的部分和传递函数依赖，因此符合3NF。

#### 15. an_pics

在关系模式`an_pics`中，由于是全码，因此没有非主属性，因此一定不存在非主属性对码的部分和传递函数依赖，因此符合3NF。



### 3. 数据库设计优化

#### (1) 增加索引

在数据库系统中, 增加索引可以实现对数据的快速检索。因此，我们对经常进行查询操作的字段增加索引信息，提高存取效率。对于主键和外键，Mysql会自动创建主键和外键索引，因此不在下方列出。

```sql
create index ti on dc_title(title);
create index pos on tb_pics(position);
```

#### (2) 增加外键

为了保证数据的一致性，以及关系模型的参照完整性，为每个联系的属性增加外键约束。同时增加级联删除功能，当主表的记录被删除时，联系表会自动删除与主表删除记录相关联的记录。以主题帖表为例，在创建表的语句中，增加：

```sql
foreign key(username) references tb_user(username) on delete cascade
```

#### (3) 模式分解与合并

​	对于码相同的关系，可以将其合并。例如两个表存在1:n的联系时，就可以省去联系表，将1端关系的id存在n端关系中，节省存储空间。例如在社团图片表中，一张图片对应唯一一个社团信息，因此将社团信息id存入该表。

​	但为了提高存取效率和存储空间的利用率，对某些1:n的联系不进行合并，仍单独建立联系表，例如主题帖与评论贴属于1:n的联系，由于主题帖id和评论贴id经常被一起使用，评论贴中一个元组占用空间较大，因此有必要单独建立联系表。
